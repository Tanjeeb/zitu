<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Runway Next  — Your next Journey Partner</title>

<!-- Tailwind Utility CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- GSAP (animation & scroll smoothing) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollSmoother.min.js" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- PARTICLE CANVAS (fireflies) -->
<canvas id="particle-canvas" aria-hidden="true"></canvas>

<!-- HEADER -->
<header class="fixed w-full z-50 top-0 left-0">
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent">
    <h1 class="text-sky-400 text-xl font-bold">Runway Next</h1>
    <nav class="hidden md:flex gap-6 items-center text-gray-300">
      <a class="nav-link hover:text-sky-300 transition" href="#s1">Home</a>
      <a class="nav-link hover:text-sky-300 transition" href="#s2">About Us</a>
      <a class="nav-link hover:text-sky-300 transition" href="#s3">Education Consultancy</a>
      
      <a class="nav-link hover:text-sky-300 transition" href="#s1">Career Consultancy</a>
      
      <a class="nav-link hover:text-sky-300 transition" href="#s1">Tours & Travels</a>
      <a class="nav-link hover:text-sky-300 transition" href="#s1">Gallery</a>
      <button id="motion-toggle" class="ml-4 text-sm bg-slate-800/50 px-3 py-1 rounded-md text-gray-200">Low Motion</button>
    </nav>
  </div>
</header>
<section id="s1" class="relative h-screen flex items-center justify-center text-center">
    <div class="cinematic-bg absolute inset-0"></div>
    <div class="floating-particles">
        <!-- 40 random particles -->
        <script>
            for (let i = 0; i < 40; i++) {
                const s = document.createElement("span");
                s.style.left = Math.random() * 100 + "%";
                s.style.animationDelay = Math.random() * 8 + "s";
                s.style.animationDuration = 7 + Math.random() * 7 + "s";
                document.currentScript.parentNode.appendChild(s);
            }
        </script>
    </div>

    <div class="relative z-20 max-w-3xl px-6 fade-up">
        <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight mb-6">
            <span class="text-sky-300">Your Journey</span>  
            <span class="block text-white">To a New Future Starts Here</span>
        </h1>

        <p class="text-lg md:text-2xl text-gray-200 mb-8">
            Premium visa consultation for global students, professionals, and immigration seekers.
            We turn dreams into destinations.
        </p>

        <div class="flex justify-center space-x-4">
            <a href="#" class="px-8 py-3 bg-sky-500 hover:bg-sky-600 text-black font-bold rounded-full text-lg shadow-xl backdrop-blur-md">
                Book Consultation
            </a>
            <a href="#" class="px-8 py-3 bg-white/10 border border-white/20 hover:bg-white/20 text-white rounded-full text-lg backdrop-blur-md">
                Explore Visas
            </a>
        </div>

        <!-- TRUST BADGES -->
        <div class="mt-10 flex justify-center gap-8 text-gray-300 text-sm">
            <div class="flex items-center space-x-2">
                <span class="text-sky-300 text-xl">★</span>
                <p>ISO Certified</p>
            </div>
            <div class="flex items-center space-x-2">
                <span class="text-sky-300 text-xl">★</span>
                <p>10,000+ Successful Visas</p>
            </div>
            <div class="flex items-center space-x-2">
                <span class="text-sky-300 text-xl">★</span>
                <p>Global Partner Network</p>
            </div>
        </div>
    </div>
</section>
<!-- SECTION 1 (Video background + multi-layer parallax + title) -->


<section id="s2" class="bg-gray-900 py-32 relative overflow-hidden">
  <div class="max-w-6xl mx-auto px-6">

    <!-- TITLE -->
    <div class="parallax-split-block flex justify-center mb-12 opacity-0 translate-y-10">
      <h3 class="w-full text-3xl md:text-4xl text-sky-400 font-semibold">About Us</h3>
      <p>Runway Next is a leading education and career consultancy firm based in Chasara, Narayanganj, dedicated to empowering students and professionals to achieve their academic and career aspirations on a global scale.</p>
    </div>

    <!-- WRAPPER FOR SPLIT EFFECT -->
    <div class="relative">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- LEFT COLUMN (moves left → center) -->
        <div class="split-left bg-gray-800 p-6 rounded-lg opacity-0 translate-x-[-80px]">
          <h4 class="font-semibold text-xl">Our mission</h4>
          <p class="text-gray-300 mt-2">Our mission is to provide expert guidance and comprehensive support to individuals seeking opportunities for higher education, professional development, and international career advancement. With a strong commitment to excellence, integrity, and personalized service, Runway Next serves as a trusted partner in every step of your journey — from academic planning to career success.</p>
        </div>

        <!-- MIDDLE stays centered but still parallax slightly -->
        <div class="split-center bg-gray-800 p-6 rounded-lg opacity-0 translate-y-[40px]">
          <h4 class="font-semibold text-xl">We offer</h4>
          <p class="text-gray-300 mt-2">We offer a wide range of services, including study abroad counselling, university admission assistance, visa guidance, career pathway consulting, and skill development support. Our experienced consultants provide tailored advice to help clients identify the best educational institutions and career options aligned with their goals, interests, and potential.</p>
        </div>

        <!-- RIGHT COLUMN (moves right → center) -->
        <div class="split-right bg-gray-800 p-6 rounded-lg opacity-0 translate-x-[80px]">
          <h4 class="font-semibold text-xl">We believe</h4>
          <p class="text-gray-300 mt-2">At Runway Next, we believe that every individual deserves a clear direction and a confident takeoff toward success. By combining global insight with local expertise, we help you make informed decisions and build a future without boundaries.</p>
        </div>

      </div>
    </div>

  </div>
</section>


<!-- SECTION 2 (Gallery + tilt + magnetic hover + depth movement) -->
<section id="s2" class="parallax" data-speed="0.12" aria-label="Forest gallery section">
  <div class="layer" style="z-index:0; background-image:url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1800');"></div>
  <div class="layer" style="z-index:2; background:linear-gradient(0deg, rgba(0,0,0,0.55), rgba(0,0,0,0.15));"></div>

  <div class="max-w-7xl mx-auto px-6 py-16 z-40" style="width:100%;">
    <h2 class="text-4xl md:text-5xl font-bold text-lime-300 mb-6 parallax-subtitle">Runway Next Gallery</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Gallery card 1 -->
      <div class="gallery-card relative overflow-hidden rounded-xl shadow-2xl bg-gradient-to-b from-black/10 to-black/30 magnet" tabindex="0" aria-label="Gallery item 1">
        <img loading="lazy" src="https://placehold.co/800x1000/0f172a/ffffff?text=Gallery+1" alt="Gallery 1" class="w-full h-80 object-cover">
        <div class="p-4">
          <h3 class="font-semibold text-lg text-white">Layered Vista</h3>
          <p class="text-gray-300 text-sm mt-1">Hover or move cursor for tilt.</p>
        </div>
      </div>

      <!-- Gallery card 2 -->
      <div class="gallery-card relative overflow-hidden rounded-xl shadow-2xl bg-gradient-to-b from-black/10 to-black/30 magnet" tabindex="0" aria-label="Gallery item 2">
        <img loading="lazy" src="https://placehold.co/800x1000/14532d/ffffff?text=Gallery+2" alt="Gallery 2" class="w-full h-80 object-cover">
        <div class="p-4">
          <h3 class="font-semibold text-lg text-white">Canopy Layers</h3>
          <p class="text-gray-300 text-sm mt-1">Subtle parallax depth on scroll.</p>
        </div>
      </div>

      <!-- Gallery card 3 -->
      <div class="gallery-card relative overflow-hidden rounded-xl shadow-2xl bg-gradient-to-b from-black/10 to-black/30 magnet" tabindex="0" aria-label="Gallery item 3">
        <img loading="lazy" src="https://placehold.co/800x1000/7c2d12/ffffff?text=Gallery+3" alt="Gallery 3" class="w-full h-80 object-cover">
        <div class="p-4">
          <h3 class="font-semibold text-lg text-white">Earthen Warmth</h3>
          <p class="text-gray-300 text-sm mt-1">Interactive magnet + tilt.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 3 (ocean horizon with depth reactive text + CTA) -->
<section id="s3" class="parallax" data-speed="0.22" aria-label="Ocean horizon section">
  <div class="layer" style="z-index:0; background-image:url('https://images.unsplash.com/photo-1470115636492-6d2b56f9146e?auto=format&fit=crop&w=1800');"></div>
  <div class="layer" style="z-index:2; background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.45));"></div>

  <div class="card z-40 text-center" style="max-width:56rem;">
    <h2 class="text-4xl md:text-5xl font-extrabold text-orange-300 parallax-title">The Horizon</h2>
    <p class="mt-4 text-gray-300">A calmer parallax pace with depth-aware fog fade and ambient particles.</p>
    <div class="mt-6">
      <button class="px-6 py-3 rounded-full bg-orange-600 hover:bg-orange-700 magnet">Explore More</button>
    </div>
  </div>
</section>
<section id="book-counselling" class="relative py-32 bg-gray-900 overflow-hidden">

  <!-- Background floating shapes -->
  <div class="absolute inset-0 -z-10">
    <div class="bg-sky-500/10 rounded-full w-96 h-96 absolute top-10 left-1/4 animate-float-slow"></div>
    <div class="bg-lime-500/10 rounded-full w-64 h-64 absolute top-1/2 right-1/4 animate-float-fast"></div>
  </div>

  <div class="max-w-4xl mx-auto px-6 relative z-10">
    <!-- Section Title -->
    <div class="text-center mb-16 step-title opacity-0 translate-y-10">
      <h2 class="text-4xl font-bold text-sky-400">Book Your Free Counselling</h2>
      <p class="text-gray-300 mt-2">Follow the steps below to get started</p>
    </div>

    <!-- Stepper Container -->
    <div class="relative flex flex-col stepper-steps space-y-20">

      <!-- Step 1 -->
      <div class="step-card bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-2xl transform opacity-0 translate-y-10 relative z-10">
        <div class="text-sky-400 text-3xl font-bold mb-3 flex items-center space-x-2">
          <span>01</span>
          <svg class="h-6 w-6 text-sky-400 float-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7h20L12 2z"/></svg>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Avail Free Counselling</h3>
        <p class="text-gray-300 text-sm">Start by requesting your free expert counselling session.</p>

        <!-- SVG Curve for this step -->
        <svg class="absolute left-1/2 -translate-x-1/2 top-full w-12 h-32" viewBox="0 0 12 32" xmlns="http://www.w3.org/2000/svg">
          <path class="connector-line" d="M6 0 C6 16 6 16 6 32" stroke="#0ea5e9" stroke-width="3" fill="transparent" stroke-linecap="round"/>
        </svg>
      </div>

      <!-- Step 2 -->
      <div class="step-card bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-2xl transform opacity-0 translate-y-10 relative z-10">
        <div class="text-sky-400 text-3xl font-bold mb-3 flex items-center space-x-2">
          <span>02</span>
          <svg class="h-6 w-6 text-sky-400 float-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/></svg>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Choose Date</h3>
        <input type="date" class="w-full mt-2 px-3 py-2 bg-gray-700 rounded-lg text-gray-200 outline-none focus:ring-2 focus:ring-sky-400" />

        <svg class="absolute left-1/2 -translate-x-1/2 top-full w-12 h-32" viewBox="0 0 12 32" xmlns="http://www.w3.org/2000/svg">
          <path class="connector-line" d="M6 0 C6 16 6 16 6 32" stroke="#facc15" stroke-width="3" fill="transparent" stroke-linecap="round"/>
        </svg>
      </div>

      <!-- Step 3 -->
      <div class="step-card bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-2xl transform opacity-0 translate-y-10 relative z-10">
        <div class="text-sky-400 text-3xl font-bold mb-3 flex items-center space-x-2">
          <span>03</span>
          <svg class="h-6 w-6 text-sky-400 float-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2v20M2 12h20"/></svg>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Time</h3>
        <input type="time" class="w-full mt-2 px-3 py-2 bg-gray-700 rounded-lg text-gray-200 outline-none focus:ring-2 focus:ring-sky-400" />

        <svg class="absolute left-1/2 -translate-x-1/2 top-full w-12 h-32" viewBox="0 0 12 32" xmlns="http://www.w3.org/2000/svg">
          <path class="connector-line" d="M6 0 C6 16 6 16 6 32" stroke="#f87171" stroke-width="3" fill="transparent" stroke-linecap="round"/>
        </svg>
      </div>

      <!-- Step 4 -->
      <div class="step-card bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-2xl transform opacity-0 translate-y-10 relative z-10">
        <div class="text-sky-400 text-3xl font-bold mb-3 flex items-center space-x-2">
          <span>04</span>
          <svg class="h-6 w-6 text-sky-400 float-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l7 7-7 7-7-7z"/></svg>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Interested Country</h3>
        <select class="w-full mt-2 px-3 py-2 bg-gray-700 rounded-lg text-gray-200 outline-none focus:ring-2 focus:ring-sky-400">
          <option>USA</option>
          <option>Canada</option>
          <option>UK</option>
          <option>Australia</option>
          <option>Europe (Schengen)</option>
        </select>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center mt-14">
      <button class="px-10 py-4 bg-sky-500 hover:bg-sky-600 text-white font-bold rounded-full text-lg shadow-xl transition transform hover:scale-105">
        Submit
      </button>
    </div>
  </div>
</section>

<!-- Existing steps remain unchanged -->

<!-- SVG container for dynamic curves with flowing effect -->
<svg id="dynamic-curves" class="absolute top-0 left-0 w-full h-full -z-10" xmlns="http://www.w3.org/2000/svg"></svg>



<!-- FOOTER -->
<footer class="bg-gray-900 text-center py-10 text-gray-400">
  <div class="max-w-6xl mx-auto px-6">
    <p>© 2025 Runway Next.</p>
  </div>
</footer>

<!-- JS - CORE LOGIC -->
<script>
    document.addEventListener("DOMContentLoaded", () => {

  const steps = document.querySelectorAll(".step-card");
  const floatIcons = document.querySelectorAll(".float-icon");
  const svg = document.getElementById("dynamic-curves");

  const curves = [];
  for(let i=0; i<steps.length-1; i++){
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.classList.add("dynamic-curve");
    path.setAttribute("stroke", ["#0ea5e9","#facc15","#f87171"][i % 3]);
    svg.appendChild(path);
    curves.push(path);
  }

  // Scroll reveal for steps
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.style.opacity = 1;
        entry.target.style.transform = "translateY(0px)";
      }
    });
  }, { threshold: 0.2 });

  steps.forEach(step => observer.observe(step));

  let offset = 0;
  window.addEventListener("scroll", () => {

    const scrollProgress = Math.min(1, Math.max(0, (window.scrollY + window.innerHeight/2) / document.body.scrollHeight));

    // Update 3D pop & floating icons
    steps.forEach((step, i) => {
      const stepTop = step.getBoundingClientRect().top;
      const windowCenter = window.innerHeight / 2;
      const distance = Math.min(1, Math.max(0, 1 - Math.abs(stepTop - windowCenter) / windowCenter));
      step.style.transform = `rotateY(${distance*5}deg) rotateX(${distance*3}deg) scale(${1 + distance*0.05})`;
    });

    floatIcons.forEach((icon, i) => {
      icon.style.transform = `translateY(${Math.sin(window.scrollY * 0.002 + i) * 6}px)`;
    });

    // Update dynamic bezier curves and animate flow
    for(let i=0; i<curves.length; i++){
      const rect1 = steps[i].getBoundingClientRect();
      const rect2 = steps[i+1].getBoundingClientRect();
      const x1 = rect1.left + rect1.width/2;
      const y1 = rect1.bottom;
      const x2 = rect2.left + rect2.width/2;
      const y2 = rect2.top;

      const cx = x1; 
      const cy = y1 + (y2-y1)/2;

      curves[i].setAttribute("d", `M ${x1},${y1} Q ${cx},${cy} ${x2},${y2}`);

      // Animate dash offset for flowing particles
      const pathLength = curves[i].getTotalLength();
      curves[i].setAttribute("stroke-dasharray", pathLength/15 + " " + pathLength/10);
      offset -= 4; // speed of flow
      curves[i].setAttribute("stroke-dashoffset", offset);
    }

  });
});

 document.addEventListener("DOMContentLoaded", () => {

  const steps = document.querySelectorAll(".step-card");
  const floatIcons = document.querySelectorAll(".float-icon");
  const svg = document.getElementById("dynamic-curves");

  // Create dynamic curves
  const curves = [];
  for(let i=0; i<steps.length-1; i++){
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.classList.add("dynamic-curve");
    path.setAttribute("stroke", ["#0ea5e9","#facc15","#f87171"][i % 3]);
    path.style.opacity = 0; // initially hidden
    svg.appendChild(path);
    curves.push(path);
  }

  // Helper function to check if a step is filled
  function isStepFilled(step){
    const input = step.querySelector("input, select");
    if(!input) return true; // step with no input is considered filled
    return input.value.trim() !== "";
  }

  // Show/hide steps based on previous completion
  function updateStepVisibility(){
    steps.forEach((step, i) => {
      if(i === 0 || isStepFilled(steps[i-1])){
        step.style.display = "block";
      } else {
        step.style.display = "none";
      }
    });

    // Show curves only if previous step is filled
    curves.forEach((curve, i) => {
      if(isStepFilled(steps[i])){
        curve.style.opacity = 1;
      } else {
        curve.style.opacity = 0;
      }
    });
  }

  // Listen to input changes
  steps.forEach((step, i) => {
    const input = step.querySelector("input, select");
    if(input){
      input.addEventListener("input", updateStepVisibility);
    }
  });

  // Initial call
  updateStepVisibility();

  // Optional: keep 3D pop + floating icons
  window.addEventListener("scroll", () => {
    steps.forEach((step) => {
      const stepTop = step.getBoundingClientRect().top;
      const windowCenter = window.innerHeight / 2;
      const distance = Math.min(1, Math.max(0, 1 - Math.abs(stepTop - windowCenter) / windowCenter));
      step.style.transform = `rotateY(${distance*5}deg) rotateX(${distance*3}deg) scale(${1 + distance*0.05})`;
    });

    floatIcons.forEach((icon, i) => {
      icon.style.transform = `translateY(${Math.sin(window.scrollY * 0.002 + i) * 6}px)`;
    });

    // Update curve positions dynamically if visible
    curves.forEach((curve, i) => {
      if(curve.style.opacity == 0) return;
      const rect1 = steps[i].getBoundingClientRect();
      const rect2 = steps[i+1].getBoundingClientRect();
      const x1 = rect1.left + rect1.width/2;
      const y1 = rect1.bottom;
      const x2 = rect2.left + rect2.width/2;
      const y2 = rect2.top;
      const cx = x1;
      const cy = y1 + (y2-y1)/2;
      curve.setAttribute("d", `M ${x1},${y1} Q ${cx},${cy} ${x2},${y2}`);
    });
  });

});





     window.addEventListener("load", () => {
        document.querySelector(".fade-up").classList.add("visible");
    });
    document.querySelectorAll('header nav a').forEach(link => {
    link.addEventListener('click', function (e) {
        e.preventDefault();

        const targetId = this.getAttribute("href");
        const section = document.querySelector(targetId);

        const headerHeight = document.querySelector("header").offsetHeight;

        window.scrollTo({
            top: section.offsetTop - headerHeight,
            behavior: "smooth"
        });
    });
});
document.addEventListener("DOMContentLoaded", () => {
    
    // Elements
    const left = document.querySelector(".split-left");
    const right = document.querySelector(".split-right");
    const center = document.querySelector(".split-center");
    const title = document.querySelector(".parallax-split-block");

    // Scroll based parallax
    window.addEventListener("scroll", () => {
        const rect = document.getElementById("s2").getBoundingClientRect();
        const progress = Math.min(1, Math.max(0, 1 - rect.top / window.innerHeight));

        // Parallax position
        left.style.transform = `translateX(${(-80 + progress * 80)}px)`;
        right.style.transform = `translateX(${(80 - progress * 80)}px)`;
        center.style.transform = `translateY(${(40 - progress * 40)}px)`;

        // Fade-in
        left.style.opacity = progress;
        right.style.opacity = progress;
        center.style.opacity = progress;
        title.style.opacity = progress;
        title.style.transform = `translateY(${10 - progress * 10}px)`;
    });

});

(() => {
  // ---- Feature flags & environment detection ----
  const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const isLowPower = navigator.deviceMemory && navigator.deviceMemory <= 2; // rough check
  const supportsGSAP = typeof gsap !== 'undefined' && typeof ScrollSmoother !== 'undefined';

  // ---- Optional GSAP ScrollSmoother setup (graceful fallback) ----
  if (!prefersReducedMotion && supportsGSAP) {
    try {
      ScrollSmoother.create({
        wrapper: document.documentElement,
        content: document.body,
        smooth: 1.05,
        effects: true,
        normalizeScroll: true // helps avoid jumps on mobile
      });
    } catch (e) {
      // fail silently to native scroll
      console.warn('GSAP ScrollSmoother not available — using native scroll fallback', e);
    }
  }

  // ---- Parallax layer system (rAF-driven, GPU friendly) ----
  const parallaxSections = Array.from(document.querySelectorAll('.parallax'));
  const layersQuery = ['.layer', '.fog', '.parallax-title', '.parallax-subtitle'];

  let lastScroll = window.scrollY;
  let ticking = false;

  function updateParallax() {
    const sy = window.scrollY;
    parallaxSections.forEach(section => {
      // center offset relative to viewport center
      const rect = section.getBoundingClientRect();
      const mid = rect.top + rect.height/2;
      const distFromCenter = (window.innerHeight/2 - mid);
      const speed = parseFloat(section.dataset.speed || 0.15);

      // Move background layers at fraction of scroll and scale subtly
      const bgTransforms = section.querySelectorAll('.layer');
      bgTransforms.forEach((el, idx) => {
        const depthFactor = (idx + 1) * speed * 0.8;
        el.style.transform = `translateY(${distFromCenter * depthFactor * 0.06}px)`;
      });

      // Fog layers depth and opacity change based on absolute scroll progress in section
      const fogDeep = section.querySelector('#fog-deep');
      const fogMid = section.querySelector('#fog-mid');
      if (fogDeep) fogDeep.style.transform = `translateY(${(window.scrollY - rect.top) * 0.02}px)`;
      if (fogMid) fogMid.style.transform = `translateY(${(window.scrollY - rect.top) * 0.015}px)`;
    });

    // Depth-reactive foreground titles (slower movement)
    document.querySelectorAll('.parallax-title, .parallax-subtitle').forEach(el => {
      const rect = el.getBoundingClientRect();
      const rel = (rect.top - window.innerHeight * 0.3);
      const mv = Math.max(Math.min(rel * -0.02, 50), -50);
      el.style.transform = `translateY(${mv}px)`;
    });

    lastScroll = sy;
    ticking = false;
  }

  window.addEventListener('scroll', () => {
    if (prefersReducedMotion) return;
    if (!ticking) {
      window.requestAnimationFrame(updateParallax);
      ticking = true;
    }
  }, { passive: true });

  // ---- Fog opacity control based on overall page progress ----
  function updateFogOpacity() {
    const docH = document.documentElement.scrollHeight - window.innerHeight;
    const pct = docH > 0 ? window.scrollY / docH : 0;
    document.querySelectorAll('.fog').forEach((f, idx) => {
      // deeper fog becomes denser towards mid-scroll; mid fog peaks later
      const base = parseFloat(f.dataset.base || getComputedStyle(f).opacity) || 0.2;
      const multiplier = 0.6 + (idx * 0.25);
      f.style.opacity = Math.max(0, Math.min(0.9, base + (pct * multiplier)));
    });
  }
  window.addEventListener('scroll', updateFogOpacity, { passive: true });
  updateFogOpacity();

  // ---- Gallery magnet & tilt behaviour ----
  const magnets = document.querySelectorAll('.magnet, .gallery-card');
  function pointerToTilt(e, el) {
    const rect = el.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const rx = ((y / rect.height) - 0.5) * 14; // rotateX
    const ry = ((x / rect.width) - 0.5) * -14; // rotateY
    el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) scale(1.04)`;
  }
  function resetTilt(el) {
    el.style.transform = `perspective(900px) rotateX(0deg) rotateY(0deg) scale(1)`;
  }
  magnets.forEach(el => {
    el.addEventListener('mousemove', (ev) => {
      if (prefersReducedMotion) return;
      pointerToTilt(ev, el);
    });
    el.addEventListener('mouseleave', () => resetTilt(el));
    el.addEventListener('focus', () => el.classList.add('focused'));
    el.addEventListener('blur', () => el.classList.remove('focused'));
  });

  // ---- Cursor trail (tiny dot) & interactive magnet attraction ----
  const cursor = { x: -100, y: -100 };
  document.addEventListener('pointermove', (e) => {
    cursor.x = e.clientX;
    cursor.y = e.clientY;
  }, { passive: true });

  // optional visual cursor dot for debugging (disabled by default).
  // To enable, create a small element pinned to body and update position.

  // ---- Particle system (lightweight fireflies) ----
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d', { alpha: true });
  let width = canvas.width = innerWidth;
  let height = canvas.height = innerHeight;
  const DPR = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = width * DPR; canvas.height = height * DPR;
  canvas.style.width = width + 'px'; canvas.style.height = height + 'px';
  ctx.scale(DPR, DPR);

  const supportsCanvas = !!ctx;
  const maxParticles = isLowPower || prefersReducedMotion ? 28 : 90;
  const particles = [];

  function rand(min, max) { return Math.random() * (max - min) + min; }

  function createParticle(i) {
    return {
      id: i,
      x: rand(0, width),
      y: rand(0, height),
      vx: rand(-0.05, 0.05),
      vy: rand(-0.06, 0.06),
      size: rand(0.8, 2.8),
      alpha: rand(0.05, 0.7),
      phase: rand(0, Math.PI * 2),
      orbit: rand(20, 120)
    };
  }

  for (let i = 0; i < maxParticles; i++) particles.push(createParticle(i));

  function drawParticles() {
    if (!supportsCanvas) return;
    ctx.clearRect(0,0,width, height);
    particles.forEach(p => {
      // subtle orbiting
      p.phase += 0.007;
      p.x += p.vx + Math.cos(p.phase) * 0.12;
      p.y += p.vy + Math.sin(p.phase) * 0.08;

      // wrap
      if (p.x < -20) p.x = width + 20;
      if (p.x > width + 20) p.x = -20;
      if (p.y < -20) p.y = height + 20;
      if (p.y > height + 20) p.y = -20;

      // draw as soft glow
      const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size*16);
      g.addColorStop(0, `rgba(255,255,255,${p.alpha})`);
      g.addColorStop(0.15, `rgba(180,220,255,${p.alpha*0.6})`);
      g.addColorStop(1, `rgba(180,220,255,0)`);

      ctx.beginPath();
      ctx.fillStyle = g;
      ctx.arc(p.x, p.y, p.size*6, 0, Math.PI*2);
      ctx.fill();
    });
  }

  let lastFrame = performance.now();
  function particleLoop(now) {
    const dt = now - lastFrame;
    lastFrame = now;
    if (!prefersReducedMotion && !isLowPower) drawParticles();
    requestAnimationFrame(particleLoop);
  }
  requestAnimationFrame(particleLoop);

  // handle resize
  function resizeCanvas() {
    width = canvas.width = innerWidth;
    height = canvas.height = innerHeight;
    canvas.width = width * DPR; canvas.height = height * DPR;
    canvas.style.width = width + 'px'; canvas.style.height = height + 'px';
    ctx.scale(DPR, DPR);
  }
  window.addEventListener('resize', () => {
    resizeCanvas();
  });

  // ---- Simple nav-active highlight using IntersectionObserver ----
  const navLinks = document.querySelectorAll('a.nav-link');
  const sections = [...document.querySelectorAll('section[id]')];
  const io = new IntersectionObserver(entries => {
    entries.forEach(e => {
      const id = e.target.id;
      const link = document.querySelector(`a.nav-link[href="#${id}"]`);
      if (e.isIntersecting) {
        navLinks.forEach(l => l.classList.remove('text-sky-300','font-semibold'));
        if (link) link.classList.add('text-sky-300','font-semibold');
      }
    });
  }, { threshold: 0.45 });

  sections.forEach(s => io.observe(s));

  // ---- Motion toggle button (explicit low-motion opt-out) ----
  const motionButton = document.getElementById('motion-toggle');
  motionButton && motionButton.addEventListener('click', () => {
    document.documentElement.classList.toggle('reduced-motion-force');
    const active = document.documentElement.classList.contains('reduced-motion-force');
    motionButton.textContent = active ? 'Motion Off' : 'Low Motion';
    if (active) {
      // disable lively effects
      canvas.style.display = 'none';
      magnets.forEach(m => resetTilt(m));
    } else {
      canvas.style.display = 'block';
    }
  });

  // ---- Video fallback and lazy loading ----
  const bgVideo = document.getElementById('bg-video');
  if (bgVideo) {
    // try to set src from data attribute if present
    const src = bgVideo.dataset.videoSrc;
    if (src && !bgVideo.querySelector('source')) {
      const s = document.createElement('source');
      s.src = src;
      s.type = 'video/mp4';
      bgVideo.appendChild(s);
    }
    // handle playback errors gracefully
    bgVideo.addEventListener('error', () => {
      bgVideo.style.display = 'none';
    });
    // if user has low data, pause video
    if (navigator.connection && /save-data/i.test(navigator.connection.effectiveType || '')) {
      bgVideo.pause();
      bgVideo.style.display = 'none';
    }
  }

  // ---- Accessibility: keyboard focus for gallery cards (adds tiny scale) ----
  document.querySelectorAll('.gallery-card').forEach(card => {
    card.addEventListener('focus', () => card.style.transform = 'scale(1.03)');
    card.addEventListener('blur', () => card.style.transform = 'scale(1)');
  });

  // initial calls
  updateParallax();
  updateFogOpacity();

  // small safe console message to help debugging
  console.info('Cinematic Parallax: initialized. Reduced motion:', prefersReducedMotion, 'Low power:', isLowPower, 'GSAP:', !!supportsGSAP);

})();
</script>

</body>
</html>
